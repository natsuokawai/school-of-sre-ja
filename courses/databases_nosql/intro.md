# NoSQLの概念

## 前提条件
- [リレーショナル・データベース](/databases_sql/intro/)

## このコースで扱うこと

このトレーニングの最後には、NoSQLデータベースとは何か、従来のRDBMSと比較してどのようなメリットやデメリットがあるのかを理解し、様々なタイプのNoSQLデータベースについて学び、NoSQLの基本的な概念やトレードオフを理解することができます。


## このコースでは扱わないこと

このコースでは、特定のNoSQLデータベースについて深く掘り下げることはありません。


## コース内容



* [NoSQLの紹介](/databases_nosql/intro/#introduction)
* [CAPの定理](/databases_nosql/key_concepts/#cap-theorem)
* [データバージョニング](/databases_nosql/key_concepts/#versioning-of-data-in-distributed-systems)
* [パーティショニング](/databases_nosql/key_concepts/#partitioning)
* [ハッシング](/databases_nosql/key_concepts/#hashing)
* [Quorum](/databases_nosql/key_concepts/#quorum)


## はじめに

人々が「NoSQLデータベース」という言葉を使うとき、一般的には非リレーショナルデータベースのことを指します。「NoSQL」という言葉は「Non SQL」の略だと言う人もいれば、「Not only SQL」の略だと言う人もいます。いずれにしても、NoSQLデータベースがリレーショナルテーブル以外の形式でデータを保存するデータベースであることにはほとんどの人が同意しています。

よくある誤解は、「NoSQLデータベースや非リレーショナルデータベースはリレーショナルデータをうまく保存できない」というものです。NoSQLデータベースはリレーショナルデータを格納できますが、その格納方法はリレーショナルデータベースとは異なります。実際、SQLデータベースと比較すると、リレーショナルデータをテーブル間で分割する必要がないため、NoSQLデータベースの方がリレーショナルデータのモデリングが容易であると考える人が多いようです。

このようなデータベースは1960年代後半から存在していましたが、「NoSQL」という名称は21世紀初頭になってから生まれたものです。NASAはアポロ計画のための在庫管理にNoSQLデータベースを使用しました。NoSQLデータベースが登場したのは、ストレージのコストが劇的に下がった2000年代後半のことです。データの重複を減らすためだけに複雑で管理の難しいデータモデルを作成する必要があった時代は終わりました。ソフトウェア開発の主なコストはストレージではなく開発者になっていたため、NoSQLデータベースは開発者の生産性を高めるために最適化されました。アジャイル開発手法の台頭により、NoSQLデータベースは拡張性と高速性を重視して開発され、同時にアプリケーションの頻繁な変更が可能になり、プログラミングが容易になりました。


### NoSQLデータベースの種類

NoSQLデータベースは企業の要求に合わせて開発されたため、時間の経過とともにかなりの種類が出てきました。しかし、大きく分けると4つのタイプに分類できます。いくつかのデータベースは異なる種類の間で重複することがあります。



1. **ドキュメント・データベース：**データを[JSON](https://www.json.org/json-en.html) (JavaScript Object Notation)オブジェクトに似たドキュメントに格納します。各ドキュメントにはフィールドと値のペアが含まれています。値には、文字列、数値、ブーリアン、配列、オブジェクトなど様々な種類があり、その構造は開発者がコードで扱うオブジェクトによく似ています。直感的なデータモデルと柔軟なスキーマが利点です。ドキュメントデータベースは、多様なフィールド値のタイプと強力なクエリ言語を備えているためさまざまなユースケースに適しており、汎用データベースとして使用することができます。また、大規模なデータ量に対応するために水平方向にスケールアウトすることができます。例：MongoDB、Couchbase
2. **キーバリューデータベース：** よりシンプルなタイプのデータベースで、各項目にキーと値が含まれています。値は通常そのキーを参照することでのみ取得できるため、特定のキーと値のペアを検索する方法を学ぶことは一般的に簡単です。キーバリューデータベースは、大量のデータを保存する必要があるが複雑なクエリを実行してデータを取り出す必要がない場合に最適です。一般的な使用例としては、ユーザーの好みを保存したりキャッシングを行ったりすることが挙げられます。例：[Redis](https://redis.io/)、[DynamoDB](https://aws.amazon.com/dynamodb/)、[Voldemort](https://www.project-voldemort.com/voldemort/)/[Venice](https://engineering.linkedin.com/blog/2017/04/building-venice--a-production-software-case-study) (Linkedin)
3. **ワイドカラムストア：** テーブル、行、ダイナミックカラムでデータを保存します。ワイドカラムストアは、各行が同じカラムを持つ必要がないため、リレーショナルデータベースに比べて柔軟性が高いです。多くの人はワイドカラムストアを2次元のキーバリューデータベースとみなしています。ワイドカラムストアは、大量のデータを保存する必要がありかつクエリのパターンが予測できる場合に最適です。ワイドカラムストアは、IoTデータやユーザープロファイルデータの保存によく使われます。[Cassandra](https://cassandra.apache.org/)と[HBase](https://hbase.apache.org/)は、最も人気のあるワイドカラムストアの2つです。
4. **グラフデータベース：** これらのデータベースは、データをノードとエッジに格納します。ノードは通常、人、場所、物に関する情報を格納し、エッジはノード間の関係に関する情報を格納します。グラフデータベースの基本的な記憶メカニズムは様々である。リレーショナルエンジンに依存し、グラフデータをテーブルに「格納」するものもあります（ただし、テーブルは論理的な要素であるため、このアプローチでは、グラフデータベース、グラフデータベース管理システム、およびデータが実際に格納される物理デバイスの間に、別のレベルの抽象化が必要となる）。また、キーバリューストアやドキュメント指向のデータベースを使用するものもあり、本質的にNoSQLの構造となっています。グラフデータベースは、ソーシャルネットワーク、不正検知、レコメンデーションエンジンなど、関係性を辿ってパターンを探す必要があるユースケースに優れています。例：[Neo4j](https://neo4j.com/) 


### **比較**

| |パフォーマンス|スケーラビリティ|柔軟性|複雑さ|機能|
|:----|:----|:----|:----|:----|:----|
|キーバリュー|高|高|高|なし|不定|
|ドキュメント|高|不定 (高)|高|低|不定 (低)|
|ワイドカラム|高|高|中|低|最小|
|グラフ|不定|不定|高|高|グラフ理論|



### SQLとNoSQLの相違点

下の表は、SQLデータベースとNoSQLデータベースの主な違いをまとめたものです。

| |SQLデータベース|NoSQLデータベース|
|:----|:----|:----|
|データストレージモデル|固定の行と列を持つテーブル|ドキュメント: JSONドキュメント<br>キーバリュー：キーと値のペア<br>ワイドカラム：行と動的な列を持つテーブル<br>グラフ：ノードとエッジ|
|主な目的|一般的な目的|ドキュメント：一般的な目的<br>キーバリュー：単純なルックアップクエリを持つ大量のデータ<br>ワイドカラム：予測可能なクエリパターンを持つ大量のデータ<br>グラフ：接続されたデータ間の関係性の分析と走査|
|スキーマ|厳格|柔軟|
|スケーリング|垂直（より大きなサーバーでスケールアップ）|水平（コモディティサーバーでスケールアウト）|
|複数レコード[ACID](https://ja.wikipedia.org/wiki/ACID_(%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E7%A7%91%E5%AD%A6))トランザクション|対応|ほとんどは非対応。MongoDBなど一部対応|
|結合（JOIN）|一般的に必要|一般的に不要|
|データからオブジェクトへのマッピング|ORM(object-relational mapping)が必要|多くの場合ORMを必要としない。<br>ドキュメントDBのドキュメントはほとんどの一般的なプログラミング言語のデータ構造に直接マッピングされる。|


### 利点



* **柔軟なデータモデル**

    ほとんどのNoSQLシステムは柔軟なスキーマを備えています。柔軟なスキーマとは、進化するアプリケーションの要求に対応するために、フィールドの追加や削除などデータベースのスキーマを容易に変更できることを意味します。これにより、データベース運用のオーバーヘッドを伴わずに継続的な新機能のアプリケーション開発が可能になります。

* **水平方向の拡張性**

    ほとんどのNoSQLシステムでは水平方向に拡張することができます。これは、システムを拡張したいときに安価なコモディティハードウェアを追加できることを意味します。一方、SQLシステムは一般的に垂直方向にスケールします（より強力なサーバーを使用します）。NoSQLシステムは、従来のSQLシステムに比べて巨大なデータセットを扱うことができます。

* **高速なクエリ**

    NoSQLはデータの非正規化と水平方向のスケーリングにより、一般的に従来のSQLシステムよりもはるかに高速です。また、ほとんどのNoSQLシステムでは類似したデータをまとめて保存する傾向があるため、クエリの応答が速くなります。

* **開発者の生産性**

    NoSQLシステムでは、プログラムのデータ構造に基づいてデータをマッピングする傾向があります。その結果開発者はデータ変換を行う必要が少なくなり、生産性の向上とバグの減少につながります。
