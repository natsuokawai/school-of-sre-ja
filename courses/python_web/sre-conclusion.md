# まとめ

## アプリのスケールアップ

設計と開発は旅の一部に過ぎません。遅かれ早かれ、継続的インテグレーションと継続的デリバリーのパイプラインをセットアップする必要があります。そして、このアプリをどこかにデプロイしなければなりません。

最初は、任意のクラウドプロバイダー上の1つの仮想マシンにアプリをデプロイすることから始めましょう。しかしこれでは「単一障害点」となってしまい、SREとして（あるいはエンジニアとして）絶対に許されないことです。そこで改善策としては、ロードバランサーの後ろに複数のアプリケーションのインスタンスを配置することです。これにより、1台のマシンがダウンするという問題を確実に防ぐことができます。

ここでのスケーリングは、ロードバランサーの後ろにさらにインスタンスを追加することです。しかし、これはある一定の範囲までしか拡張できません。例えば、DBがボトルネックになったり、ロードバランサー自体がボトルネックになったりします。何がボトルネックになっているかを知るにはどうすればいいのでしょうか？アプリケーションやアーキテクチャの各側面を観測できるようにする必要があります。

メトリクスがあって初めて、どこで何が問題になっているのかを知ることができます。**測定されたものは修正されるのです！**

School of SREの[スケーラビリティのセクション](../systems_design/scalability.md)からスケーリングについてのより深い洞察を得て、それに目を通した後、学んだことや得られたものをこのアプリに適用してください。どうやってこのアプリを地理的に分散させ、高い可用性と拡張性を持たせるかを考えてみましょう。

## モニタリング戦略

アプリケーションがデプロイされると、しばらくは順調に動いているでしょうが、永遠ではありません。信頼性は私たちの仕事のタイトルであり、私たちは何らかの方法で設計を行うことでシステムの信頼性を高めます。しかし、それでもシステムはダウンします。マシンは故障します。ディスクはおかしな動きをします。バグのあるコードが本番環境に投入されることもあるでしょう。これらすべてがもたらしうるシナリオは、システムの信頼性を低下させます。では、どうすればいいでしょうか？**モニタリングしましょう！**

システムの健全性を監視し、何か予想外のことがあれば警告してほしいのです。

ここで、URL短縮アプリについて考えてみましょう。私たちはそれを監視する必要があります。そして、何か問題が発生した場合には通知を受けたいと思います。しかし、私たちはまず、監視したい「何か」とは何かを決める必要があります。

1. このアプリはHTTPリクエストを扱うウェブアプリなので、HTTPステータスコードとレイテンシーを監視します。
2. リクエストの量も候補の一つです。アプリが異常な量のトラフィックを受信している場合、何かがおかしいかもしれません。
3. データベースにも注意を払いたいので、選択したデータベースソリューションに応じて、クエリ時間、ボリューム、ディスク使用量など。
4. 最後に、データセンターの外にあるデバイスから定期的にテストを行う外部モニタリングも必要です。これによって顧客をエミュレートし、顧客の視点からシステムが期待通りに動作していることを確認します。

## SREの役割における応用

SREの世界では、Pythonは広く使われている言語です。様々な目的のために開発された小さなスクリプトやツールのために使われます。SREが開発したツールは重要なインフラを扱い、（物事を停止させる）大きな力を持っているので、プログラミング言語とその機能を使っている間に何をしているのかを知ることが重要です。また、問題をデバッグする際にも、言語とその特徴を知ることは同様に重要です。SREとしてPython言語をより深く理解することで、非常に巧妙なバグをデバッグするのに非常に役立ちますし、設計上の決定を行う際により多くの情報を得ることができます。

ツールの開発はSREの仕事の一部かもしれませんが、ツールやサービスのサポートは日常的に行われていると思います。アプリケーションやツールの構築は、プロダクション業務のほんの一部に過ぎません。アプリケーション自体の設計には堅牢性を高めるための工夫が施されていますが、SREとしては、アプリケーションがデプロイされて稼働した後の信頼性と安定性に責任を負うことになります。それを確実にするためには、まずアプリケーションを理解し、適切に監視し、様々な障害シナリオに備えるための戦略を考える必要があります。

## エクササイズ

1. 入力パラメータに応じて関数の戻り値をキャッシュするデコレーターを作成しましょう。
2. URL短縮アプリを任意のクラウドプロバイダーにホスティングしましょう。
3. CatchpointやDatadogなどのツールを使ってモニタリングを設定しましょう。
4. TCPソケット上に最小限のFlaskのようなフレームワークを作成しましょう。

## まとめ

このモジュールの最初のパートでは、プログラミング言語としてPythonを選択したときに起こることや、Pythonプログラムを実行したときに起こることをより認識してもらうことを目的としています。Pythonがオブジェクトとして内部的に物事を処理する方法の知識があれば、Pythonの一見魔法のように見える多くのことがより意味を持ち始めるでしょう。

2つめのパートでは、まずTCPやHTTPなどのプロトコルに関する既存の知識を用いて、Flaskのようなフレームワークがどのように動作するかを説明しました。その後、SREの部分を含むアプリケーション開発のライフサイクル全体に触れました。考慮した設計とアーキテクチャの分野は完全ではありませんが、SREとしても重要な事柄とその理由の概要を知ることができます。
